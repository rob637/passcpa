/**
 * CMA Part 1: Advanced Concepts Flashcards
 * Deep-dive concept, formula, and mnemonic cards for Part 1 advanced topics
 * 15 flashcards covering frequently-tested formulas and tricky concepts
 */

import { CMAFlashcard } from './types';

export const CMA1_ADVANCED_CONCEPTS: CMAFlashcard[] = [
  {
    id: 'cma1-adv-001',
    section: 'CMA1',
    type: 'formula',
    topic: 'Cost Accounting',
    subtopic: 'Variable vs Absorption Costing Income',
    blueprintArea: 'CMA1-C',
    front: 'How do you reconcile Variable Costing income to Absorption Costing income?',
    back: 'Absorption Income = Variable Income + (Fixed OH rate × Change in Inventory Units)\n\nIf production > sales → Absorption > Variable (fixed costs deferred in inventory)\nIf production < sales → Absorption < Variable (deferred costs released)',
    formula: 'Difference = Fixed OH per unit × (Units Produced − Units Sold)',
    difficulty: 'hard',
    tags: ['absorption costing', 'variable costing', 'reconciliation'],
  },
  {
    id: 'cma1-adv-002',
    section: 'CMA1',
    type: 'formula',
    topic: 'External Financial Reporting',
    subtopic: 'Diluted EPS',
    blueprintArea: 'CMA1-A',
    front: 'Diluted EPS: Treasury Stock Method for stock options?',
    back: 'Step 1: Options exercised → shares issued at exercise price\nStep 2: Proceeds used to buy back shares at average market price\nStep 3: Net new shares = Shares issued − Shares repurchased\nStep 4: Add net new shares to denominator\n\nOnly dilutive if exercise price < market price.',
    formula: 'Net new shares = Options × (1 − Exercise Price / Market Price)',
    difficulty: 'hard',
    tags: ['diluted EPS', 'treasury stock method', 'options'],
  },
  {
    id: 'cma1-adv-003',
    section: 'CMA1',
    type: 'mnemonic',
    topic: 'External Financial Reporting',
    subtopic: 'Cash Flow Classification',
    blueprintArea: 'CMA1-A',
    front: 'What\'s a mnemonic for items that go in Operating, Investing, and Financing cash flows?',
    back: '**Operating (indirect):** Start with NI, adjust for non-cash items (D&A, gains/losses), changes in working capital.\n\n**Investing:** "PALS" — Property/plant, Acquisitions, Loans made, Securities purchased/sold\n\n**Financing:** "DEBS" — Dividends paid, Equity issued/repurchased, Borrowing/repaying, Stock issuance',
    mnemonic: 'Investing = PALS; Financing = DEBS',
    difficulty: 'medium',
    tags: ['cash flow statement', 'operating', 'investing', 'financing'],
  },
  {
    id: 'cma1-adv-004',
    section: 'CMA1',
    type: 'formula',
    topic: 'Performance Management',
    subtopic: 'Economic Value Added',
    blueprintArea: 'CMA1-D',
    front: 'Economic Value Added (EVA) formula and interpretation?',
    back: 'EVA = NOPAT − (WACC × Invested Capital)\nor EVA = (ROIC − WACC) × Invested Capital\n\nNOPAT = EBIT × (1 − Tax Rate)\n\nEVA > 0: Creating shareholder value\nEVA < 0: Destroying value\n\nAdvantage over ROI: Dollar amount shows actual value created; avoids suboptimal investment rejection.',
    formula: 'EVA = NOPAT − (WACC × Invested Capital)',
    difficulty: 'hard',
    tags: ['EVA', 'value creation', 'NOPAT'],
  },
  {
    id: 'cma1-adv-005',
    section: 'CMA1',
    type: 'formula',
    topic: 'Budgeting',
    subtopic: 'Variance Analysis',
    blueprintArea: 'CMA1-B',
    front: 'Complete the 3-column variance analysis for materials?',
    back: 'Column 1: Actual Qty × Actual Price (AQ × AP)\nColumn 2: Actual Qty × Standard Price (AQ × SP)\nColumn 3: Standard Qty × Standard Price (SQ × SP)\n\n**Price Variance** = Col 1 − Col 2 = AQ × (AP − SP)\n**Quantity Variance** = Col 2 − Col 3 = SP × (AQ − SQ)\n**Total Variance** = Col 1 − Col 3 = Price + Quantity',
    formula: 'MPV = AQ(AP − SP); MQV = SP(AQ − SQ)',
    difficulty: 'hard',
    tags: ['material variance', 'price variance', 'quantity variance'],
  },
  {
    id: 'cma1-adv-006',
    section: 'CMA1',
    type: 'concept',
    topic: 'Performance Management',
    subtopic: 'Balanced Scorecard',
    blueprintArea: 'CMA1-D',
    front: 'The four perspectives of the Balanced Scorecard and their causal chain?',
    back: '**Learning & Growth** → **Internal Business Processes** → **Customer** → **Financial**\n\nCausal chain: Invest in people/systems → Improve internal processes → Satisfy customers → Achieve financial goals\n\n**Lagging indicators:** Financial results\n**Leading indicators:** Employee training hours, process cycle time, customer acquisition',
    difficulty: 'medium',
    tags: ['balanced scorecard', 'Kaplan', 'Norton', 'perspectives'],
  },
  {
    id: 'cma1-adv-007',
    section: 'CMA1',
    type: 'formula',
    topic: 'Cost Accounting',
    subtopic: 'Process Costing',
    blueprintArea: 'CMA1-C',
    front: 'FIFO Method: How do you compute equivalent units in process costing?',
    back: 'EU = (Beg WIP × % to complete) + Units started AND completed + (End WIP × % complete)\n\nUnits S&C = Units completed − Beg WIP units\n\nKey difference from Weighted Average: FIFO excludes work already done on Beg WIP.\nCost per EU = Current period costs only ÷ FIFO equivalent units.',
    formula: 'EU(FIFO) = BegWIP × (1 − % complete) + S&C + EndWIP × % complete',
    difficulty: 'hard',
    tags: ['process costing', 'FIFO', 'equivalent units'],
  },
  {
    id: 'cma1-adv-008',
    section: 'CMA1',
    type: 'concept',
    topic: 'Internal Controls',
    subtopic: 'COSO Internal Control Framework',
    blueprintArea: 'CMA1-E',
    front: 'COSO Internal Control: 5 components and 17 principles?',
    back: '**Components (mnemonic: CR-ICE):**\n1. Control Environment (5 principles) — Tone at top\n2. Risk Assessment (4 principles) — Identify/analyze risks\n3. Information & Communication (3 principles) — Relevant, quality info\n4. Control Activities (3 principles) — Policies/procedures\n5. Monitoring Activities (2 principles) — Ongoing/separate evaluations\n\n17 principles total. All must be present and functioning.',
    mnemonic: 'CR-ICE: Control environment, Risk assessment, Information & communication, Control activities, (Monitoring) Evaluations',
    difficulty: 'medium',
    tags: ['COSO', 'internal controls', 'framework'],
  },
  {
    id: 'cma1-adv-009',
    section: 'CMA1',
    type: 'formula',
    topic: 'External Financial Reporting',
    subtopic: 'Pension Accounting',
    blueprintArea: 'CMA1-A',
    front: 'Components of Net Periodic Pension Cost under ASC 715?',
    back: '**Pension Expense = S + I − R + A ± G ± P**\n\n+ Service cost (current year benefit earned)\n+ Interest cost (PBO × discount rate)\n− Expected return on plan assets\n+ Amortization of prior service cost\n± Amortization of net gain/loss (corridor approach)\n± Amortization of transition obligation\n\n**Only service cost** is in operating income; rest is in other income/expense.',
    formula: 'Pension Expense = Service + Interest − Expected Return + Amortizations',
    difficulty: 'hard',
    tags: ['pension', 'ASC 715', 'pension expense'],
  },
  {
    id: 'cma1-adv-010',
    section: 'CMA1',
    type: 'formula',
    topic: 'Budgeting',
    subtopic: 'Learning Curves',
    blueprintArea: 'CMA1-B',
    front: 'How does the learning curve model work for budgeting?',
    back: 'Each time cumulative output doubles, the cumulative average time per unit falls to a fixed percentage (the learning rate).\n\n**80% learning curve example:**\n- 1 unit: 100 hrs\n- 2 units: 80 hrs avg = 160 total\n- 4 units: 64 hrs avg = 256 total\n- 8 units: 51.2 hrs avg = 409.6 total\n\n**Formula:** Y = aXᵇ where b = ln(learning rate) / ln(2)',
    formula: 'Y = aXᵇ; b = ln(LR) / ln(2)',
    difficulty: 'hard',
    tags: ['learning curve', 'forecasting', 'budgeting'],
  },
  {
    id: 'cma1-adv-011',
    section: 'CMA1',
    type: 'concept',
    topic: 'Technology & Analytics',
    subtopic: 'Data Analytics in Accounting',
    blueprintArea: 'CMA1-F',
    front: 'Four types of data analytics and their questions?',
    back: '**Descriptive:** "What happened?" — Dashboards, reports, KPIs\n\n**Diagnostic:** "Why did it happen?" — Drill-down, root cause analysis\n\n**Predictive:** "What will happen?" — Regression, forecasting, machine learning\n\n**Prescriptive:** "What should we do?" — Optimization, simulation, decision models\n\nComplexity and value increase from descriptive → prescriptive.',
    difficulty: 'medium',
    tags: ['data analytics', 'descriptive', 'predictive', 'prescriptive'],
  },
  {
    id: 'cma1-adv-012',
    section: 'CMA1',
    type: 'formula',
    topic: 'Cost Accounting',
    subtopic: 'Cost-Volume-Profit',
    blueprintArea: 'CMA1-C',
    front: 'Multi-product CVP: How do you find the breakeven point when selling multiple products?',
    back: 'Step 1: Determine sales mix ratio (units)\nStep 2: Calculate weighted-avg CM per "bundle"\n  = Σ(CM per unit × mix ratio)\nStep 3: Breakeven bundles = Fixed Costs ÷ Weighted CM per bundle\nStep 4: Multiply bundles × each product\'s ratio for individual BEs\n\n**Key assumption:** Sales mix remains constant.',
    formula: 'BE bundles = Fixed Costs ÷ Σ(CMᵢ × Mix Ratioᵢ)',
    difficulty: 'hard',
    tags: ['CVP', 'multi-product', 'breakeven', 'sales mix'],
  },
  {
    id: 'cma1-adv-013',
    section: 'CMA1',
    type: 'concept',
    topic: 'Internal Controls',
    subtopic: 'IT General Controls',
    blueprintArea: 'CMA1-E',
    front: 'IT General Controls (ITGCs) vs. Application Controls?',
    back: '**ITGCs:** Broad controls over IT environment:\n- Access security (user IDs, passwords)\n- Change management (system updates approval)\n- Computer operations (backup, disaster recovery)\n- Program development (SDLC methodology)\n\n**Application Controls:** Specific to individual applications:\n- Input controls (validation, edit checks)\n- Processing controls (run-to-run totals)\n- Output controls (distribution, reconciliation)',
    difficulty: 'medium',
    tags: ['IT controls', 'ITGC', 'application controls'],
  },
  {
    id: 'cma1-adv-014',
    section: 'CMA1',
    type: 'formula',
    topic: 'External Financial Reporting',
    subtopic: 'Deferred Taxes',
    blueprintArea: 'CMA1-A',
    front: 'Deferred Tax Assets vs. Deferred Tax Liabilities: When does each arise?',
    back: '**DTL (future taxable amounts):** Book income > Tax income NOW → pay MORE tax later.\n- Accelerated depreciation (tax) vs. straight-line (book)\n- Installment sale revenue recognized for book but deferred for tax\n\n**DTA (future deductible amounts):** Tax income > Book income NOW → pay LESS tax later.\n- Warranty expense accrued for book but deducted when paid for tax\n- Bad debt expense (allowance method book vs. direct write-off tax)\n\n**Valuation Allowance:** Reduce DTA if more likely than not (>50%) some won\'t be realized.',
    formula: 'DT = Temporary Difference × Enacted Tax Rate',
    difficulty: 'hard',
    tags: ['deferred tax', 'DTA', 'DTL', 'ASC 740'],
  },
  {
    id: 'cma1-adv-015',
    section: 'CMA1',
    type: 'mnemonic',
    topic: 'Performance Management',
    subtopic: 'Responsibility Accounting',
    blueprintArea: 'CMA1-D',
    front: 'Four types of responsibility centers: What does each manager control?',
    back: '**Cost Center:** Controls costs only (e.g., manufacturing dept)\n**Revenue Center:** Controls revenues only (e.g., sales dept)\n**Profit Center:** Controls both revenues AND costs (e.g., division)\n**Investment Center:** Controls revenues, costs, AND invested capital (e.g., strategic business unit)\n\nEvaluation metrics escalate: Costs → Revenue → Profit → ROI/RI/EVA',
    mnemonic: 'CRPI: Costs, Revenue, Profit, Investment — each adds more control',
    difficulty: 'medium',
    tags: ['responsibility centers', 'cost center', 'profit center', 'investment center'],
  },
];
