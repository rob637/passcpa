/**
 * CMA Part 2: Advanced Concepts Flashcards
 * Deep-dive concept, formula, and mnemonic cards for Part 2 advanced topics
 * 15 flashcards covering high-frequency CMA Part 2 tested concepts
 */

import { CMAFlashcard } from './types';

export const CMA2_ADVANCED_CONCEPTS: CMAFlashcard[] = [
  {
    id: 'cma2-adv-001',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'WACC Calculation',
    blueprintArea: 'CMA2-B',
    front: 'Complete WACC formula with all components?',
    back: 'WACC = wₑ × kₑ + w_d × k_d × (1 − T) + w_p × k_p\n\n**Weights:** Target or market-value based (not book value)\n**kₑ:** CAPM = Rf + β(Rm − Rf) or DDM = D₁/P₀ + g\n**k_d:** YTM on existing debt (not coupon rate)\n**k_p:** D_p / P_p (no tax adjustment—dividends not deductible)\n\n**Key:** Use after-tax cost of debt. Preferred stock has NO tax shield.',
    formula: 'WACC = wₑkₑ + w_dk_d(1−T) + w_pk_p',
    difficulty: 'hard',
    tags: ['WACC', 'cost of capital', 'CAPM'],
  },
  {
    id: 'cma2-adv-002',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'DuPont Analysis',
    blueprintArea: 'CMA2-A',
    front: 'The 3-component and 5-component DuPont decompositions?',
    back: '**3-Component:** ROE = Profit Margin × Asset Turnover × Equity Multiplier\nROE = (NI/Sales) × (Sales/Assets) × (Assets/Equity)\n\n**5-Component:** ROE = Tax Burden × Interest Burden × Operating Margin × Asset Turnover × Equity Multiplier\nROE = (NI/EBT) × (EBT/EBIT) × (EBIT/Sales) × (Sales/Assets) × (Assets/Equity)\n\nThe 5-component isolates tax, interest, and operating effects.',
    formula: 'ROE = (NI/Sales)(Sales/TA)(TA/Equity)',
    difficulty: 'hard',
    tags: ['DuPont', 'ROE', 'decomposition'],
  },
  {
    id: 'cma2-adv-003',
    section: 'CMA2',
    type: 'concept',
    topic: 'Investment Decisions',
    subtopic: 'Real Options',
    blueprintArea: 'CMA2-E',
    front: 'Types of real options in capital budgeting?',
    back: '**Option to Abandon:** Walk away, recover salvage value. Puts a floor on losses.\n\n**Option to Expand:** Scale up if project succeeds. Adds upside value.\n\n**Option to Delay/Defer:** Wait for uncertainty to resolve. Valuable when NPV ≈ 0.\n\n**Option to Contract:** Scale down during downturn.\n\n**Switching Option:** Change inputs/outputs based on prices.\n\nReal options ADD value to NPV → Strategic NPV = Traditional NPV + Real Option Value.',
    difficulty: 'hard',
    tags: ['real options', 'strategic NPV', 'flexibility'],
  },
  {
    id: 'cma2-adv-004',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Theory of Constraints',
    blueprintArea: 'CMA2-C',
    front: 'Theory of Constraints (TOC): How to maximize profit with a bottleneck?',
    back: '**Key metric:** Throughput contribution per unit of bottleneck resource.\n\nThroughput = Revenue − Totally variable costs (materials only)\n\n**Steps:**\n1. Identify the binding constraint (bottleneck)\n2. Calculate throughput margin per unit of constraint for each product\n3. Rank products by throughput/constraint unit (highest first)\n4. Allocate bottleneck capacity accordingly\n\n**TOC ignores fixed costs** — maximize throughput, not traditional CM.',
    formula: 'Rank by: (Selling Price − Materials) / Constraint time per unit',
    difficulty: 'hard',
    tags: ['TOC', 'throughput', 'bottleneck', 'constraint'],
  },
  {
    id: 'cma2-adv-005',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'Working Capital Management',
    blueprintArea: 'CMA2-B',
    front: 'Cash Conversion Cycle (CCC) formula and interpretation?',
    back: 'CCC = DSO + DIO − DPO\n\n**DSO** (Days Sales Outstanding) = A/R ÷ (Revenue/365)\n**DIO** (Days Inventory Outstanding) = Inventory ÷ (COGS/365)\n**DPO** (Days Payables Outstanding) = A/P ÷ (COGS/365)\n\n**Shorter CCC** = Less time cash is tied up = Better liquidity\n\nReduce CCC: Collect receivables faster, turn inventory faster, or stretch payables.',
    formula: 'CCC = DSO + DIO − DPO',
    difficulty: 'medium',
    tags: ['CCC', 'working capital', 'liquidity'],
  },
  {
    id: 'cma2-adv-006',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'Modified Internal Rate of Return',
    blueprintArea: 'CMA2-E',
    front: 'MIRR: Why and how?',
    back: '**Why:** IRR assumes reinvestment at IRR (unrealistic). MIRR assumes reinvestment at a separate rate (usually WACC).\n\n**Steps:**\n1. Discount all negative cash flows to t=0 at financing rate\n2. Compound all positive cash flows to terminal year at reinvestment rate\n3. MIRR = (Terminal Value / PV of costs)^(1/n) − 1\n\nAdvantages: Single solution, realistic reinvestment, still a % return.',
    formula: 'MIRR = (TV of inflows / PV of outflows)^(1/n) − 1',
    difficulty: 'hard',
    tags: ['MIRR', 'IRR', 'reinvestment rate'],
  },
  {
    id: 'cma2-adv-007',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Transfer Pricing Rule',
    blueprintArea: 'CMA2-C',
    front: 'General transfer pricing rule for goal congruence?',
    back: '**Minimum TP = Variable cost per unit + Opportunity cost per unit**\n\n**If selling division has excess capacity:** TP ≥ Variable cost (opportunity cost = $0)\n\n**If selling division is at full capacity:** TP ≥ Variable cost + Lost CM per unit\n\n**Maximum TP = Market price** (buying division won\'t pay more than external price)\n\nNegotiated range: Variable cost + Opportunity cost ≤ TP ≤ Market price',
    formula: 'Min TP = VC/unit + Opportunity Cost/unit',
    difficulty: 'hard',
    tags: ['transfer pricing', 'opportunity cost', 'goal congruence'],
  },
  {
    id: 'cma2-adv-008',
    section: 'CMA2',
    type: 'mnemonic',
    topic: 'Risk Management',
    subtopic: 'COSO ERM Components',
    blueprintArea: 'CMA2-D',
    front: 'COSO ERM 2017 Framework: 5 components and 20 principles?',
    back: '**Components:**\n1. **Governance & Culture** (5 principles) — Board oversight, operating structure, values\n2. **Strategy & Objective-Setting** (4) — Analyze context, define risk appetite, align strategy\n3. **Performance** (5) — Identify risks, assess severity, prioritize, implement responses\n4. **Review & Revision** (3) — Monitor, review, pursue improvement\n5. **Information, Communication & Reporting** (3) — Leverage IT, communicate, report\n\n**Mnemonic: "GS-PRR" or "Great Strategy Performs (with) Review & Reporting"**',
    mnemonic: 'GS-PRR: Governance, Strategy, Performance, Review, Reporting',
    difficulty: 'hard',
    tags: ['COSO ERM 2017', 'risk framework', 'governance'],
  },
  {
    id: 'cma2-adv-009',
    section: 'CMA2',
    type: 'concept',
    topic: 'Ethics',
    subtopic: 'IMA Conflict Resolution',
    blueprintArea: 'CMA2-F',
    front: 'IMA\'s recommended conflict resolution steps?',
    back: '**Steps (in order):**\n1. Follow organization\'s established policies\n2. Discuss with immediate supervisor (unless supervisor is involved)\n3. If supervisor involved, go to next higher level of management\n4. If unresolved, go to the audit committee or board of directors\n5. Contact IMA Ethics Helpline for guidance\n6. Consult an attorney regarding legal obligations\n\n**Do NOT:** Go to the press/media, go above chain without exhausting internal steps, or violate confidentiality publicly.',
    difficulty: 'medium',
    tags: ['IMA ethics', 'conflict resolution', 'whistleblowing'],
  },
  {
    id: 'cma2-adv-010',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'Altman Z-Score',
    blueprintArea: 'CMA2-A',
    front: 'Altman Z-Score model for bankruptcy prediction?',
    back: '**Z = 1.2X₁ + 1.4X₂ + 3.3X₃ + 0.6X₄ + 1.0X₅**\n\nX₁ = Working Capital / Total Assets\nX₂ = Retained Earnings / Total Assets\nX₃ = EBIT / Total Assets\nX₄ = Market Value Equity / Book Value Total Liabilities\nX₅ = Sales / Total Assets\n\n**Z > 2.99:** Safe zone\n**1.81 < Z < 2.99:** Grey zone\n**Z < 1.81:** Distress zone (bankruptcy likely)',
    formula: 'Z = 1.2(WC/TA) + 1.4(RE/TA) + 3.3(EBIT/TA) + 0.6(MVE/BVL) + 1.0(S/TA)',
    difficulty: 'hard',
    tags: ['Altman Z-Score', 'bankruptcy', 'financial distress'],
  },
  {
    id: 'cma2-adv-011',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'Modigliani-Miller',
    blueprintArea: 'CMA2-B',
    front: 'Modigliani-Miller Propositions (with and without taxes)?',
    back: '**Without taxes:**\nProp I: V_L = V_U (capital structure irrelevant)\nProp II: kₑ = k₀ + (k₀ − k_d)(D/E)\n\n**With taxes:**\nProp I: V_L = V_U + TD (value of tax shield)\nProp II: kₑ = k₀ + (k₀ − k_d)(D/E)(1 − T)\n\n**Key insight:** With taxes, more debt → higher firm value (up to distress costs). WACC decreases with leverage due to tax shield.',
    formula: 'V_L = V_U + T×D; kₑ = k₀ + (k₀ − k_d)(D/E)(1−T)',
    difficulty: 'hard',
    tags: ['Modigliani-Miller', 'capital structure', 'tax shield'],
  },
  {
    id: 'cma2-adv-012',
    section: 'CMA2',
    type: 'concept',
    topic: 'Decision Analysis',
    subtopic: 'Target Costing',
    blueprintArea: 'CMA2-C',
    front: 'Target Costing process and relationship to Kaizen Costing?',
    back: '**Target Costing (design phase):**\nTarget Cost = Market Price − Required Profit Margin\n\nStart with competitive price → subtract desired margin → cost becomes the constraint → design to cost target → VE (value engineering) to eliminate costs.\n\n**Kaizen Costing (production phase):**\nContinuous cost reduction AFTER production begins. Small, incremental improvements.\n\n**Lifecycle flow:** Target Costing → Product Design → Kaizen Costing → Continuous Improvement',
    difficulty: 'medium',
    tags: ['target costing', 'kaizen', 'value engineering'],
  },
  {
    id: 'cma2-adv-013',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'Sustainable Growth Rate',
    blueprintArea: 'CMA2-A',
    front: 'What is the Sustainable Growth Rate (SGR) and why does it matter?',
    back: '**SGR = ROE × Retention Ratio**\nSGR = ROE × (1 − Dividend Payout Ratio)\n\nor using DuPont:\nSGR = (PM × AT × EM) × b\n\n**Meaning:** Maximum growth rate achievable without raising external equity or changing capital structure.\n\nIf actual growth > SGR → Must issue new equity, increase leverage, improve margins, or reduce dividends.',
    formula: 'SGR = ROE × (1 − Payout Ratio)',
    difficulty: 'medium',
    tags: ['sustainable growth', 'SGR', 'retention ratio'],
  },
  {
    id: 'cma2-adv-014',
    section: 'CMA2',
    type: 'concept',
    topic: 'Risk Management',
    subtopic: 'Risk Responses',
    blueprintArea: 'CMA2-D',
    front: 'Four risk response strategies?',
    back: '**Avoid:** Eliminate the activity causing risk. Strongest response but may forgo opportunity.\n\n**Reduce/Mitigate:** Implement controls to lower probability or impact. Most common strategy.\n\n**Share/Transfer:** Shift risk to third party via insurance, hedging, outsourcing, or JVs.\n\n**Accept:** Acknowledge risk and absorb impact. Appropriate when cost of response > expected loss.\n\n**Sequence:** Prefer avoidance for catastrophic risks → mitigation for manageable risks → transfer for insurable risks → acceptance for immaterial risks.',
    difficulty: 'medium',
    tags: ['risk response', 'risk mitigation', 'risk acceptance'],
  },
  {
    id: 'cma2-adv-015',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'Equivalent Annual Annuity',
    blueprintArea: 'CMA2-E',
    front: 'Equivalent Annual Annuity (EAA) for comparing projects with different lives?',
    back: '**Problem:** NPV cannot directly compare mutually exclusive projects with different useful lives.\n\n**EAA Method:**\n1. Compute NPV for each project\n2. Convert NPV to an annuity: EAA = NPV / PV annuity factor\n   EAA = NPV × [r / (1 − (1+r)^−n)]\n3. Choose project with highest EAA\n\n**Alternative:** Replacement chain method (find common life multiple).\n\n**Assumption:** Projects can be repeated indefinitely at same terms.',
    formula: 'EAA = NPV / PVIFA(r, n)',
    difficulty: 'hard',
    tags: ['EAA', 'unequal lives', 'replacement chain'],
  },
];
