/**
 * CMA Part 2: Strategic Financial Management - Flashcard Formulas
 * Key calculations and formulas for CMA Part 2
 */

import { CMAFlashcard } from './types';

export const CMA2_FORMULAS: CMAFlashcard[] = [
  // ============================================
  // A: Financial Statement Analysis (20%)
  // ============================================
  {
    id: 'cma2-form-001',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'Liquidity Ratios',
    blueprintArea: 'CMA2-A',
    front: 'What are the formulas for key liquidity ratios?',
    back: '**Current Ratio** = Current Assets / Current Liabilities\n\n**Quick Ratio** = (Cash + Marketable Securities + A/R) / Current Liabilities\n\n**Cash Ratio** = Cash & Equivalents / Current Liabilities\n\n**Working Capital** = Current Assets - Current Liabilities',
    formula: 'Current = CA/CL; Quick = (Cash+MS+AR)/CL',
    example: 'CA $500K, CL $250K, Inventory $150K, Prepaid $50K\nCurrent = 500/250 = 2.0\nQuick = (500-150-50)/250 = 1.2',
    difficulty: 'easy',
    tags: ['liquidity', 'ratios'],
  },
  {
    id: 'cma2-form-002',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'Activity Ratios',
    blueprintArea: 'CMA2-A',
    front: 'What are the formulas for activity (turnover) ratios?',
    back: '**Inventory Turnover** = COGS / Average Inventory\n**Days Inventory** = 365 / Inventory Turnover\n\n**Receivables Turnover** = Net Credit Sales / Average A/R\n**Days Sales Outstanding** = 365 / A/R Turnover\n\n**Payables Turnover** = COGS / Average A/P\n**Days Payables** = 365 / Payables Turnover\n\n**Asset Turnover** = Net Sales / Average Total Assets',
    formula: 'Turnover = Activity ÷ Average Balance; Days = 365 ÷ Turnover',
    difficulty: 'medium',
    tags: ['activity', 'turnover', 'ratios'],
  },
  {
    id: 'cma2-form-003',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'DuPont Analysis',
    blueprintArea: 'CMA2-A',
    front: 'What is the DuPont formula for ROE?',
    back: '**3-Factor DuPont:**\n\nROE = (Net Income/Sales) × (Sales/Assets) × (Assets/Equity)\n\nROE = **Profit Margin** × **Asset Turnover** × **Equity Multiplier**\n\n**Extended 5-Factor:**\nROE = (NI/EBT) × (EBT/EBIT) × (EBIT/Sales) × (Sales/Assets) × (Assets/Equity)\n= Tax Burden × Interest Burden × Operating Margin × Asset Turnover × Financial Leverage',
    formula: 'ROE = (NI/S) × (S/A) × (A/E) = PM × AT × EM',
    example: 'PM 5%, AT 1.5×, EM 2.0×\nROE = 0.05 × 1.5 × 2.0 = 15%',
    difficulty: 'medium',
    tags: ['DuPont', 'ROE'],
  },
  {
    id: 'cma2-form-004',
    section: 'CMA2',
    type: 'formula',
    topic: 'Financial Analysis',
    subtopic: 'Cash Conversion Cycle',
    blueprintArea: 'CMA2-A',
    front: 'How do you calculate the Cash Conversion Cycle?',
    back: '**Cash Conversion Cycle (CCC):**\n\nCCC = DSO + DIO - DPO\n\nWhere:\n• DSO = Days Sales Outstanding (A/R days)\n• DIO = Days Inventory Outstanding\n• DPO = Days Payables Outstanding\n\n**Interpretation:**\n• Lower CCC = Less capital tied up\n• Negative CCC = Collect from customers before paying suppliers',
    formula: 'CCC = DSO + DIO - DPO',
    example: 'DSO: 45 days, DIO: 60 days, DPO: 30 days\nCCC = 45 + 60 - 30 = 75 days',
    difficulty: 'medium',
    tags: ['cash cycle', 'working capital'],
  },

  // ============================================
  // B: Corporate Finance (20%)
  // ============================================
  {
    id: 'cma2-form-005',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'WACC',
    blueprintArea: 'CMA2-B',
    front: 'How do you calculate Weighted Average Cost of Capital (WACC)?',
    back: '**WACC Formula:**\n\nWACC = (E/V × Re) + (D/V × Rd × (1-T))\n\nWhere:\n• E = Market value of equity\n• D = Market value of debt\n• V = Total value (E + D)\n• Re = Cost of equity (use CAPM)\n• Rd = Cost of debt (yield on bonds)\n• T = Corporate tax rate\n• (1-T) = Tax shield on debt',
    formula: 'WACC = (E/V × Re) + (D/V × Rd × (1-T))',
    example: 'E=$60M, D=$40M, Re=12%, Rd=6%, T=25%\nWACC = (0.60×12%) + (0.40×6%×0.75) = 7.2% + 1.8% = 9%',
    difficulty: 'medium',
    tags: ['WACC', 'cost of capital'],
  },
  {
    id: 'cma2-form-006',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'CAPM',
    blueprintArea: 'CMA2-B',
    front: 'How do you calculate the Cost of Equity using CAPM?',
    back: '**Capital Asset Pricing Model (CAPM):**\n\nRe = Rf + β × (Rm - Rf)\n\nWhere:\n• Re = Required return on equity\n• Rf = Risk-free rate (T-bill rate)\n• β = Beta (systematic risk measure)\n• Rm = Expected market return\n• (Rm - Rf) = Market risk premium\n\n**Beta interpretation:**\n• β > 1: More volatile than market\n• β < 1: Less volatile than market\n• β = 1: Moves with market',
    formula: 'Re = Rf + β(Rm - Rf)',
    example: 'Rf=3%, β=1.2, Rm=10%\nRe = 3% + 1.2×(10%-3%) = 3% + 8.4% = 11.4%',
    difficulty: 'medium',
    tags: ['CAPM', 'cost of equity', 'beta'],
  },
  {
    id: 'cma2-form-007',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'Cost of Debt',
    blueprintArea: 'CMA2-B',
    front: 'How do you calculate the After-Tax Cost of Debt?',
    back: '**After-Tax Cost of Debt:**\n\nRd(after-tax) = Rd(pre-tax) × (1 - Tax Rate)\n\n**Methods to find Rd:**\n1. Yield to maturity on existing bonds\n2. Coupon rate on recent bond issues\n3. Credit rating and spread over T-bonds\n\n**Why after-tax?** Interest is tax-deductible, creating a tax shield',
    formula: 'Rd(AT) = Rd(BT) × (1 - T)',
    example: 'Pre-tax cost of debt: 8%, Tax rate: 25%\nAfter-tax cost = 8% × (1 - 0.25) = 6%',
    difficulty: 'easy',
    tags: ['cost of debt', 'tax shield'],
  },
  {
    id: 'cma2-form-008',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'Dividend Growth Model',
    blueprintArea: 'CMA2-B',
    front: 'How do you calculate Cost of Equity using the Dividend Growth Model?',
    back: '**Gordon Growth Model (DDM):**\n\nRe = (D₁ / P₀) + g\n\nWhere:\n• Re = Required return on equity\n• D₁ = Expected dividend next year = D₀ × (1+g)\n• P₀ = Current stock price\n• g = Expected dividend growth rate\n\n**Also used to value stock:**\nP₀ = D₁ / (Re - g)\n\n**Limitation:** Assumes constant growth forever',
    formula: 'Re = (D₁/P₀) + g = (D₀(1+g)/P₀) + g',
    example: 'D₀=$2, P₀=$40, g=5%\nD₁ = $2 × 1.05 = $2.10\nRe = ($2.10/$40) + 5% = 5.25% + 5% = 10.25%',
    difficulty: 'medium',
    tags: ['DDM', 'dividend growth', 'valuation'],
  },

  // ============================================
  // C: Decision Analysis (25%)
  // ============================================
  {
    id: 'cma2-form-009',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Break-Even',
    blueprintArea: 'CMA2-C',
    front: 'What are the Break-Even formulas?',
    back: '**Break-Even Point (Units):**\nBE units = Fixed Costs / CM per unit\n\n**Break-Even Point (Dollars):**\nBE $ = Fixed Costs / CM Ratio\n\n**Where:**\n• CM per unit = Price - Variable Cost per unit\n• CM Ratio = CM per unit / Price = 1 - VC%\n\n**Target Profit:**\nUnits = (FC + Target Profit) / CM per unit\nDollars = (FC + Target Profit) / CM Ratio',
    formula: 'BE units = FC/CM; BE$ = FC/CM%',
    example: 'FC=$100K, Price=$50, VC=$30\nCM = $20, CM% = 40%\nBE = $100K/$20 = 5,000 units\nBE$ = $100K/0.40 = $250K',
    difficulty: 'easy',
    tags: ['break-even', 'CVP'],
  },
  {
    id: 'cma2-form-010',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Operating Leverage',
    blueprintArea: 'CMA2-C',
    front: 'What is the Degree of Operating Leverage (DOL)?',
    back: '**Degree of Operating Leverage:**\n\nDOL = Contribution Margin / Operating Income\n\nDOL = % Change in Operating Income / % Change in Sales\n\n**Interpretation:**\n• Higher DOL = More fixed costs = Greater risk\n• Higher DOL = Greater profit swing from sales changes\n\n**Example interpretation:**\nDOL of 3 means: 10% increase in sales → 30% increase in operating income',
    formula: 'DOL = CM / Operating Income',
    example: 'Sales $500K, VC $300K, FC $100K\nCM = $200K, OI = $100K\nDOL = $200K/$100K = 2.0',
    difficulty: 'medium',
    tags: ['operating leverage', 'risk'],
  },
  {
    id: 'cma2-form-011',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Financial Leverage',
    blueprintArea: 'CMA2-C',
    front: 'What is the Degree of Financial Leverage (DFL)?',
    back: '**Degree of Financial Leverage:**\n\nDFL = EBIT / (EBIT - Interest)\n\nDFL = % Change in EPS / % Change in EBIT\n\n**Interpretation:**\n• Higher DFL = More debt = Greater financial risk\n• DFL magnifies changes in EBIT to EPS\n\n**Degree of Total Leverage (DTL):**\nDTL = DOL × DFL\nDTL = CM / (EBIT - Interest)',
    formula: 'DFL = EBIT/(EBIT - Interest); DTL = DOL × DFL',
    example: 'EBIT $100K, Interest $20K\nDFL = $100K/$80K = 1.25',
    difficulty: 'medium',
    tags: ['financial leverage', 'risk'],
  },
  {
    id: 'cma2-form-012',
    section: 'CMA2',
    type: 'formula',
    topic: 'Decision Analysis',
    subtopic: 'Margin of Safety',
    blueprintArea: 'CMA2-C',
    front: 'How do you calculate the Margin of Safety?',
    back: '**Margin of Safety:**\n\nMOS (units) = Actual Sales - Break-even Sales\n\nMOS (dollars) = Actual Sales$ - Break-even Sales$\n\nMOS (percentage) = MOS$ / Actual Sales$\n\n**Interpretation:**\n• How far sales can drop before losses occur\n• Higher MOS = Lower risk\n• Measures "buffer" against downturns',
    formula: 'MOS = Actual - BE; MOS% = MOS/Actual',
    example: 'Actual sales: $400K, BE: $250K\nMOS = $400K - $250K = $150K\nMOS% = $150K/$400K = 37.5%',
    difficulty: 'easy',
    tags: ['margin of safety', 'CVP'],
  },

  // ============================================
  // E: Investment Decisions (15%)
  // ============================================
  {
    id: 'cma2-form-013',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'NPV',
    blueprintArea: 'CMA2-E',
    front: 'How do you calculate Net Present Value (NPV)?',
    back: '**Net Present Value:**\n\nNPV = -Initial Investment + Σ [CFt / (1+r)^t]\n\n**Or using PV factors:**\nNPV = -Initial Investment + (CF₁ × PVF₁) + (CF₂ × PVF₂) + ...\n\n**Decision Rule:**\n• NPV > 0: Accept (creates value)\n• NPV < 0: Reject (destroys value)\n• NPV = 0: Indifferent (earns exactly required return)',
    formula: 'NPV = -I₀ + Σ(CFt/(1+r)^t)',
    example: 'Investment: $100K, CFs: $40K/year for 4 years, r=10%\nNPV = -100K + 40K×3.1699 = -100K + 126.8K = $26.8K',
    difficulty: 'medium',
    tags: ['NPV', 'capital budgeting'],
  },
  {
    id: 'cma2-form-014',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'IRR',
    blueprintArea: 'CMA2-E',
    front: 'How do you calculate Internal Rate of Return (IRR)?',
    back: '**IRR:** The discount rate that makes NPV = 0\n\n0 = -I₀ + Σ [CFt / (1+IRR)^t]\n\n**Calculation methods:**\n• Trial and error / interpolation\n• Financial calculator\n• Excel: =IRR(range)\n\n**Decision Rule:**\n• IRR > Required return: Accept\n• IRR < Required return: Reject\n\n**Limitations:**\n• Multiple IRRs with unconventional cash flows\n• Reinvestment rate assumption',
    formula: 'Find r where: 0 = -I₀ + Σ(CFt/(1+r)^t)',
    example: 'Investment: $100K, Annual CF: $35K for 4 years\nIRR ≈ 15% (rate where NPV = 0)',
    difficulty: 'hard',
    tags: ['IRR', 'capital budgeting'],
  },
  {
    id: 'cma2-form-015',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'Payback Period',
    blueprintArea: 'CMA2-E',
    front: 'How do you calculate the Payback Period?',
    back: '**Simple Payback (if CFs are equal):**\nPayback = Initial Investment / Annual Cash Flow\n\n**Uneven Cash Flows:**\n1. Cumulate cash flows year by year\n2. Find year when cumulative CF turns positive\n3. Interpolate: Prior year + (Remaining / Next year CF)\n\n**Discounted Payback:**\nSame process but use discounted (PV) cash flows\n\n**Limitations:** Ignores time value (simple), ignores CFs after payback',
    formula: 'Payback = Investment / Annual CF (if equal)',
    example: 'Investment: $100K, CFs: Year 1: $30K, Year 2: $40K, Year 3: $50K\nCumulatives: $30K, $70K, $120K\nPayback = 2 + ($30K/$50K) = 2.6 years',
    difficulty: 'easy',
    tags: ['payback', 'capital budgeting'],
  },
  {
    id: 'cma2-form-016',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'Profitability Index',
    blueprintArea: 'CMA2-E',
    front: 'How do you calculate the Profitability Index (PI)?',
    back: '**Profitability Index:**\n\nPI = PV of Future Cash Flows / Initial Investment\n\n**Or:**\nPI = (NPV + Initial Investment) / Initial Investment\nPI = 1 + (NPV / Initial Investment)\n\n**Decision Rule:**\n• PI > 1: Accept (same as NPV > 0)\n• PI < 1: Reject\n\n**Use:** Capital rationing - rank projects by PI',
    formula: 'PI = PV of CFs / Investment = 1 + (NPV/Investment)',
    example: 'Investment: $100K, PV of CFs: $126.8K\nPI = $126.8K/$100K = 1.268',
    difficulty: 'easy',
    tags: ['PI', 'capital budgeting'],
  },
  {
    id: 'cma2-form-017',
    section: 'CMA2',
    type: 'formula',
    topic: 'Investment Decisions',
    subtopic: 'EAA',
    blueprintArea: 'CMA2-E',
    front: 'How do you calculate Equivalent Annual Annuity (EAA)?',
    back: '**Equivalent Annual Annuity:**\nUsed to compare projects with different lives\n\nEAA = NPV / PVIFA(r, n)\n\n**Or:**\nEAA = NPV × (r / [1 - (1+r)^-n])\n\n**Steps:**\n1. Calculate NPV for each project\n2. Convert to EAA using annuity factor\n3. Choose project with higher EAA\n\n**Assumption:** Projects can be repeated indefinitely',
    formula: 'EAA = NPV / PVIFAr,n',
    example: 'Project A: NPV $50K, 3-year life, r=10%\nPVIFA(10%,3) = 2.4869\nEAA = $50K / 2.4869 = $20,105/year',
    difficulty: 'hard',
    tags: ['EAA', 'unequal lives'],
  },

  // ============================================
  // D: Risk Management
  // ============================================
  {
    id: 'cma2-form-018',
    section: 'CMA2',
    type: 'formula',
    topic: 'Risk Management',
    subtopic: 'Expected Value',
    blueprintArea: 'CMA2-D',
    front: 'How do you calculate Expected Value in decision making?',
    back: '**Expected Value:**\n\nEV = Σ (Probability × Outcome)\n\nEV = (P₁ × O₁) + (P₂ × O₂) + ... + (Pn × On)\n\n**Use in capital budgeting:**\n• Weight NPVs by probability of each scenario\n• Expected NPV = Σ(Prob × NPV)\n\n**Limitations:**\n• Ignores variance (risk)\n• May not represent any actual outcome',
    formula: 'EV = Σ(Pi × Oi)',
    example: 'Good economy (40%): NPV $100K\nModerate (35%): NPV $50K\nBad (25%): NPV -$20K\nExpected NPV = 0.4×100 + 0.35×50 + 0.25×(-20) = $52.5K',
    difficulty: 'medium',
    tags: ['expected value', 'probability'],
  },
  {
    id: 'cma2-form-019',
    section: 'CMA2',
    type: 'formula',
    topic: 'Risk Management',
    subtopic: 'Standard Deviation',
    blueprintArea: 'CMA2-D',
    front: 'How do you calculate Standard Deviation for risk analysis?',
    back: '**Variance:**\nσ² = Σ [Pi × (Oi - EV)²]\n\n**Standard Deviation:**\nσ = √σ² = √(Σ [Pi × (Oi - EV)²])\n\n**Coefficient of Variation (CV):**\nCV = σ / Expected Value\n\n**Use:**\n• Measures dispersion/risk\n• CV allows comparison across different sized projects\n• Lower CV = Lower relative risk',
    formula: 'σ = √(Σ[Pi×(Oi-EV)²]); CV = σ/EV',
    example: 'EV = $52.5K\nVariance = 0.4×(100-52.5)² + 0.35×(50-52.5)² + 0.25×(-20-52.5)² = 2,068.75\nσ = √2,068.75 = $45.5K',
    difficulty: 'hard',
    tags: ['standard deviation', 'variance', 'risk'],
  },
  {
    id: 'cma2-form-020',
    section: 'CMA2',
    type: 'formula',
    topic: 'Corporate Finance',
    subtopic: 'Sustainable Growth',
    blueprintArea: 'CMA2-B',
    front: 'How do you calculate the Sustainable Growth Rate?',
    back: '**Sustainable Growth Rate:**\n\ng* = ROE × Retention Ratio\n\ng* = ROE × (1 - Dividend Payout Ratio)\n\n**Expanded:**\ng* = Profit Margin × Asset Turnover × Equity Multiplier × (1 - Payout)\n\n**Meaning:** Maximum growth rate achievable without external equity financing while maintaining current financial ratios',
    formula: 'g* = ROE × b where b = Retention Ratio = 1 - Payout',
    example: 'ROE: 15%, Payout ratio: 40%\nRetention = 1 - 0.40 = 0.60\ng* = 15% × 0.60 = 9%',
    difficulty: 'medium',
    tags: ['sustainable growth', 'retention'],
  },
];
