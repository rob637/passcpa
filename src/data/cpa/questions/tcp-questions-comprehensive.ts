// TCP - Tax Compliance & Planning Comprehensive Questions
// 2026 CPA Exam Blueprint Compliant
// World-Class expansion - Final batch

import { Question } from '../../../types';

export const TCP_QUESTIONS_COMPREHENSIVE: Question[] = [
  {
    id: 'tcp-adv-001',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-individual',
    topic: 'Individual Taxation',
    subtopic: 'Passive Activity Grouping',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'Taxpayers may elect to group passive activities if:',
    options: [
      'All activities are profitable',
      'Activities form an appropriate economic unit based on similarities in business type, location, or interdependence',
      'IRS approves',
      'They choose to',
    ],
    correctAnswer: 1,
    explanation: 'Grouping election (Reg. 1.469-4): activities form appropriate economic unit. Factors: similarities of business, common control, common ownership, location, interdependence. Once grouped, treated as single activity. Regrouping limited.',
    reference: 'IRC §469 - Grouping Rules',
  },
  {
    id: 'tcp-adv-002',
    courseId: 'cpa',
    section: 'TCP',
    blueprintArea: 'TCP-I',
    topic: 'Individual Taxation',
    subtopic: 'Self-Employment Tax',
    difficulty: 'hard',
    skillLevel: 'Analysis',
    question: 'A taxpayer has $200,000 of net investment income and modified AGI of $350,000 (filing single). What is the net investment income tax (NIIT) liability under IRC §1411?',
    options: [
      '$5,700 — 3.8% on the lesser of NII or MAGI exceeding $200,000',
      '$7,600 — 3.8% on $200,000 NII',
      '$13,300 — 3.8% on $350,000',
      '$0 — NIIT only applies to passive income',
    ],
    correctAnswer: 0,
    explanation: 'The NIIT is 3.8% on the lesser of (1) net investment income ($200,000) or (2) MAGI exceeding the threshold ($350,000 − $200,000 = $150,000 for single filers). The lesser amount is $150,000. NIIT = $150,000 × 3.8% = $5,700. Net investment income includes interest, dividends, capital gains, rents, royalties, and passive business income. Wages and active business income are excluded.',
    reference: 'IRC §1401, §1402',
  },
  {
    id: 'tcp-adv-003',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-individual',
    topic: 'Individual Taxation',
    subtopic: 'Hobby Loss Rules',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'Under the hobby loss rules, an activity is presumed for profit if:',
    options: [
      'The taxpayer claims profit motive',
      'It is registered as a business',
      'There is any revenue',
      'It produces profit in 3 of 5 consecutive years (2 of 7 for horses)',
    ],
    correctAnswer: 3,
    explanation: '§183 hobby loss: presumption of profit motive if profit in 3 of 5 years (2 of 7 for horse breeding/racing). If hobby: income included, but post-TCJA no misc itemized deductions allowed. Nine factors considered.',
    reference: 'IRC §183',
  },
  {
    id: 'tcp-comp-004',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-corporate',
    topic: 'Corporate Taxation',
    subtopic: 'Earnings Stripping',
    difficulty: 'hard',
    blueprintArea: 'TCP-II',
    skillLevel: 'Analysis',
    question: 'The business interest limitation under §163(j) disallows:',
    options: [
      'All interest',
      'Foreign interest only',
      'Personal interest only',
      'Business interest expense exceeding 30% of adjusted taxable income (with carryforward)',
    ],
    correctAnswer: 3,
    explanation: '§163(j): limit business interest deduction to 30% of ATI (EBITDA through 2025, then EBIT). Excess carried forward indefinitely. Exceptions: small business ($29M gross receipts), electing real property/farming, floor plan financing.',
    reference: 'IRC §163(j)',
  },
  {
    id: 'tcp-comp-005',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-corporate',
    topic: 'Corporate Taxation',
    subtopic: 'Affiliated Groups',
    difficulty: 'hard',
    blueprintArea: 'TCP-II',
    skillLevel: 'Analysis',
    question: 'An affiliated group eligible for consolidated returns requires:',
    options: [
      'Any related corporations',
      'Same business activity',
      'Common parent owning 80% vote and value of at least one subsidiary in unbroken chain',
      '51% ownership',
    ],
    correctAnswer: 2,
    explanation: 'Affiliated group: common parent owns directly ≥80% vote AND value of at least one subsidiary. Each includible corporation must be 80% owned by group members. Exclusions: S corps, foreign corps, tax-exempt, certain REITs.',
    reference: 'IRC §1504',
  },
  {
    id: 'tcp-comp-006',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-scorp',
    topic: 'S Corporation',
    subtopic: 'Qualified Subchapter S Subsidiary',
    difficulty: 'hard',
    blueprintArea: 'TCP-III',
    skillLevel: 'Analysis',
    question: 'A QSub (Qualified Subchapter S Subsidiary) is:',
    options: [
      'A foreign subsidiary',
      'A 100%-owned domestic subsidiary of an S corp that elects QSub status, disregarded for federal tax',
      'An S corp shareholder',
      'Any subsidiary',
    ],
    correctAnswer: 1,
    explanation: 'QSub: 100% owned by S corp parent, elects disregarded status. Assets/liabilities/income treated as parent\'s. No separate return. Parent remains S corp. Election irrevocable for 5 years unless consent.',
    reference: 'IRC §1361(b)(3)',
  },
  {
    id: 'tcp-comp-007',
    courseId: 'cpa',
    section: 'TCP',
    blueprintArea: 'TCP-III',
    topic: 'S Corporation',
    subtopic: 'Built-In Gains Tax',
    difficulty: 'hard',
    skillLevel: 'Analysis',
    question: 'An S corporation shareholder who materially participates in the business has a beginning stock basis of $100,000 and a loan basis of $20,000. During the year, the S corp allocates $90,000 of ordinary income, $40,000 of separately stated long-term capital gains, and $155,000 of ordinary losses. What is the character and amount of the shareholder\'s deductible loss?',
    options: [
      '$155,000 fully deductible — basis is first increased by $130,000 income items to $250,000, which exceeds the $155,000 loss',
      'Only $100,000 deductible, limited to stock basis',
      '$120,000 deductible, limited to stock plus debt basis',
      '$155,000 fully deductible because income exceeds losses',
    ],
    correctAnswer: 0,
    explanation: 'Step 1: Increase basis for income items. Stock basis: $100,000 + $90,000 income + $40,000 LTCG = $230,000. Total basis with loan: $230,000 + $20,000 = $250,000. Step 2: Deduct losses against basis. $155,000 loss ≤ $250,000 total basis. The full $155,000 loss is deductible. Losses first reduce stock basis ($230,000 − $155,000 = $75,000), leaving debt basis intact at $20,000. Final stock basis = $75,000, final debt basis = $20,000.',
    reference: 'IRC §1374',
  },
  {
    id: 'tcp-comp-008',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-partnership',
    topic: 'Partnership Taxation',
    subtopic: 'Substantial Economic Effect',
    difficulty: 'hard',
    blueprintArea: 'TCP-IV',
    skillLevel: 'Evaluation',
    question: 'Special allocations in a partnership must have:',
    options: [
      'IRS approval',
      'Equal allocation',
      'Written consent only',
      'Substantial economic effect (economic effect + substantiality) or be allocated according to partners\' interests',
    ],
    correctAnswer: 3,
    explanation: 'Special allocation valid if substantial economic effect. Economic effect: capital account maintenance, liquidation per capital accounts, deficit restoration. Substantiality: reasonable possibility affects partners\' shares independent of tax.',
    reference: 'IRC §704(b) Regulations',
  },
  {
    id: 'tcp-comp-009',
    courseId: 'cpa',
    section: 'TCP',
    blueprintArea: 'TCP-IV',
    topic: 'Partnership Taxation',
    subtopic: 'Guaranteed Payments',
    difficulty: 'hard',
    skillLevel: 'Analysis',
    question: 'A limited partnership has a general partner (10%) and two limited partners (45% each). The partnership has $200,000 of ordinary income and pays guaranteed payments of $60,000 to the general partner for services. What is each partner\'s distributive share of ordinary income?',
    options: [
      'General partner: $14,000 + $60,000 guaranteed payment; each limited partner: $63,000',
      'General partner: $60,000; each limited partner: $70,000',
      'General partner: $80,000; each limited partner: $60,000',
      'General partner: $20,000 + $60,000; each limited partner: $60,000',
    ],
    correctAnswer: 0,
    explanation: 'Guaranteed payments are deducted from partnership income before the remaining income is allocated. Partnership ordinary income after guaranteed payments: $200,000 − $60,000 = $140,000. General partner\'s share: 10% × $140,000 = $14,000 + $60,000 guaranteed payment = $74,000 total. Each limited partner: 45% × $140,000 = $63,000. The guaranteed payment is treated as ordinary income to the general partner under IRC §707(c), regardless of partnership profitability.',
    reference: 'IRC §707(c)',
  },
  {
    id: 'tcp-comp-010',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-property',
    topic: 'Property Transactions',
    subtopic: 'Installment Sales Limitations',
    difficulty: 'hard',
    blueprintArea: 'TCP-V',
    skillLevel: 'Analysis',
    question: 'Installment sale treatment is NOT available for:',
    options: [
      'Personal property sales',
      'Real estate sales',
      'Dealer dispositions, depreciation recapture, or publicly traded securities',
      'Sales to related parties',
    ],
    correctAnswer: 2,
    explanation: 'Installment sale exclusions: dealer property, inventory, stocks/securities, §1245/1250 recapture (recognized in year of sale). Related party rules: if buyer disposes within 2 years, accelerate seller\'s remaining gain.',
    reference: 'IRC §453',
  },
  {
    id: 'tcp-comp-011',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-property',
    topic: 'Property Transactions',
    subtopic: 'Opportunity Zones',
    difficulty: 'hard',
    blueprintArea: 'TCP-V',
    skillLevel: 'Analysis',
    question: 'A Qualified Opportunity Zone investment provides:',
    options: [
      'Tax credits only',
      'Gain deferral until 2026, basis step-up, and potential exclusion of new appreciation after 10 years',
      'Immediate tax exemption',
      'Depreciation benefits only',
    ],
    correctAnswer: 1,
    explanation: 'QOZ benefits: (1) defer original capital gain until 2026 (or earlier sale), (2) basis step-up for gains in QOZ (was 10%/5yr, 15%/7yr - expired), (3) exclude appreciation after 10-year hold. Must invest within 180 days of gain.',
    reference: 'IRC §1400Z-2',
  },
  {
    id: 'tcp-comp-012',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-international',
    topic: 'International Taxation',
    subtopic: 'Subpart F CFC Income',
    difficulty: 'hard',
    blueprintArea: 'TCP-VI',
    skillLevel: 'Analysis',
    question: 'A U.S. individual owns 25% of a controlled foreign corporation. The CFC has $400,000 of Subpart F income consisting entirely of foreign personal holding company income. What is the U.S. shareholder\'s inclusion?',
    options: [
      '$100,000 — 25% of the CFC\'s Subpart F income is included in the shareholder\'s current-year gross income',
      '$0 — Subpart F income only applies to corporate shareholders',
      '$400,000 — the full CFC income is attributed to each shareholder',
      '$100,000 but only when the CFC makes a distribution',
    ],
    correctAnswer: 0,
    explanation: 'Under IRC §951, U.S. shareholders (10%+ ownership) of a CFC must include their pro-rata share of Subpart F income in gross income currently, regardless of whether the income is distributed. Foreign personal holding company income is a defined Subpart F category under IRC §954(c). The shareholder includes 25% × $400,000 = $100,000 as ordinary income. A deemed-paid foreign tax credit under §960 may apply.',
    reference: 'IRC §951, §954',
  },
  {
    id: 'tcp-comp-013',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-international',
    topic: 'International Taxation',
    subtopic: 'Participation Exemption',
    difficulty: 'hard',
    blueprintArea: 'TCP-VI',
    skillLevel: 'Analysis',
    question: 'A U.S. corporation receives a $1,000,000 dividend from a 100%-owned foreign subsidiary. Under the TCJA participation exemption, what is the tax treatment?',
    options: [
      '100% dividends received deduction (DRD) under IRC §245A — the dividend is effectively tax-free to the U.S. parent',
      'The dividend is fully taxable at 21%',
      '70% dividends received deduction',
      '50% dividends received deduction',
    ],
    correctAnswer: 0,
    explanation: 'The TCJA introduced IRC §245A, providing a 100% participation DRD for dividends received from specified 10%-owned foreign corporations by U.S. C corporation shareholders. This effectively creates a territorial-like system for repatriated foreign earnings. The deduction applies to the foreign-source portion of the dividend. Individual shareholders do not qualify for the §245A DRD. The DRD is not available for hybrid dividends.',
    reference: 'IRC §245A',
  },
  {
    id: 'tcp-comp-014',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-individual',
    topic: 'Individual Taxation',
    subtopic: 'Kiddie Tax',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Application',
    question: 'The kiddie tax applies to unearned income of:',
    options: [
      'Self-employment income',
      'All children',
      'Children under 19 (or under 24 if student) with unearned income above threshold, taxed at parents\' rate',
      'Adult dependents only',
    ],
    correctAnswer: 2,
    explanation: 'Kiddie tax: child\'s unearned income above threshold ($2,500 for 2024) taxed at parents\' marginal rate. Applies: under 19, or under 24 if student and not self-supporting. Prevents income shifting. Form 8615.',
    reference: 'IRC §1(g)',
  },
  {
    id: 'tcp-comp-015',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-estate',
    topic: 'Estate & Gift Tax',
    subtopic: 'Generation-Skipping Tax',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'The generation-skipping transfer tax applies to:',
    options: [
      'All gifts',
      'Charitable transfers',
      'Transfers to beneficiaries more than one generation below the transferor (skip persons)',
      'Spouse gifts only',
    ],
    correctAnswer: 2,
    explanation: 'GST tax: prevents avoiding estate tax by skipping generations. Skip person = 2+ generations below (grandchild). Types: direct skip, taxable termination, taxable distribution. Separate GST exemption ($13.61M for 2024). 40% flat rate.',
    reference: 'IRC §§2601-2664',
  },
  {
    id: 'tcp-comp-016',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-estate',
    topic: 'Estate & Gift Tax',
    subtopic: 'Special Use Valuation',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'Special use valuation under §2032A allows:',
    options: [
      'Qualifying farm or business real property to be valued based on actual use rather than highest and best use',
      'Immediate step-up',
      'Unlimited reduction',
      'FMV reduction for any property',
    ],
    correctAnswer: 0,
    explanation: '§2032A: value farm/business realty at actual use (not development potential). Requirements: 50% of estate in farm/business, 25% in real property, qualified use 5 of 8 years before death, heir continues use. Recapture if sold/changed within 10 years.',
    reference: 'IRC §2032A',
  },
  {
    id: 'tcp-comp-017',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-corporate',
    topic: 'Corporate Taxation',
    subtopic: 'Corporate Alternative Minimum Tax',
    difficulty: 'hard',
    blueprintArea: 'TCP-II',
    skillLevel: 'Analysis',
    question: 'The new Corporate Alternative Minimum Tax (CAMT) applies to:',
    options: [
      'Small businesses',
      'All corporations',
      'S corporations',
      'Corporations with average annual adjusted financial statement income exceeding $1 billion',
    ],
    correctAnswer: 3,
    explanation: 'CAMT (post-IRA 2022): 15% minimum tax on adjusted financial statement income for corporations averaging >$1B book income (3-year test). Adjustments for depreciation, NOLs, tax credits. FTC allowed. Tentative minimum tax minus regular tax.',
    reference: 'IRC §55 (as amended)',
  },
  {
    id: 'tcp-comp-018',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-qbi',
    topic: 'Qualified Business Income',
    subtopic: 'SSTB Limitations',
    difficulty: 'hard',
    blueprintArea: 'TCP-IV',
    skillLevel: 'Analysis',
    question: 'Specified service trades or businesses (SSTBs) face QBI deduction limitations when:',
    options: [
      'Any service income',
      'Always limited',
      'Never limited',
      'Taxable income exceeds the threshold amount ($182,100 single / $364,200 MFJ for 2024)',
    ],
    correctAnswer: 3,
    explanation: 'SSTB: health, law, accounting, actuarial, performing arts, consulting, athletics, financial services, brokerage, reputation-based. Above threshold: phaseout over $50K/$100K. Fully excluded above. Non-SSTB uses W-2/capital limits.',
    reference: 'IRC §199A(d)',
  },
  {
    id: 'tcp-comp-019',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-individual',
    topic: 'Individual Taxation',
    subtopic: 'State Tax Workarounds',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'Pass-through entity (PTE) elective taxes allow:',
    options: [
      'Federal tax credits',
      'State tax elimination',
      'Unlimited SALT deduction',
      'Entity-level state tax payment deductible by the entity, bypassing $10,000 SALT cap for owners',
    ],
    correctAnswer: 3,
    explanation: 'PTE tax election: many states allow pass-through entities to pay state tax at entity level. Deductible for federal purposes (no $10K limit). Owner receives credit/adjustment for state taxes. IRS Notice 2020-75 blessed.',
    reference: 'IRS Notice 2020-75',
  },
  {
    id: 'tcp-comp-020',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-retirement',
    topic: 'Retirement Planning',
    subtopic: 'Roth Conversions',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Analysis',
    question: 'A Roth conversion strategy is most beneficial when:',
    options: [
      'Current tax rate is lower than expected future rate, and taxpayer can pay tax from non-retirement funds',
      'Already in highest bracket',
      'Always beneficial',
      'Taxpayer needs immediate income',
    ],
    correctAnswer: 0,
    explanation: 'Roth conversion: pay tax now for tax-free future growth/withdrawals. Best when: current low bracket, long time horizon, can pay tax externally. Consider: Medicare surcharges, ACA subsidies, state taxes. No income limits for conversion.',
    reference: 'IRC §408A - Roth IRAs',
  },
  {
    id: 'tcp-comp-021',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-credits',
    topic: 'Tax Credits',
    subtopic: 'R&D Credit',
    difficulty: 'hard',
    blueprintArea: 'TCP-II',
    skillLevel: 'Analysis',
    question: 'The R&D tax credit under §41 requires activities that:',
    options: [
      'Are market research',
      'Use existing technology',
      'Involve technological uncertainty, process of experimentation, and qualified purpose (new/improved product/process)',
      'Are routine quality control',
    ],
    correctAnswer: 2,
    explanation: '§41 R&D credit: 4-part test: (1) permitted purpose (new/improved function, performance, reliability, quality), (2) technological uncertainty, (3) process of experimentation, (4) technological in nature. QREs: wages, supplies, contract research.',
    reference: 'IRC §41',
  },
  {
    id: 'tcp-comp-022',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-credits',
    topic: 'Tax Credits',
    subtopic: 'Energy Credits',
    difficulty: 'hard',
    blueprintArea: 'TCP-II',
    skillLevel: 'Application',
    question: 'The Inflation Reduction Act enhanced clean energy tax credits by:',
    options: [
      'Limiting to corporations',
      'Reducing credit amounts',
      'Extending credits, adding transferability, and bonus credits for domestic content/prevailing wage',
      'Eliminating all credits',
    ],
    correctAnswer: 2,
    explanation: 'IRA 2022: extended ITC/PTC through 2032+, added direct pay for tax-exempt entities, transferability to third parties, bonus credits for domestic content, prevailing wage/apprenticeship, energy communities, low-income.',
    reference: 'Inflation Reduction Act - Clean Energy',
  },
  {
    id: 'tcp-comp-023',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-international',
    topic: 'International Taxation',
    subtopic: 'GILTI No QBAI',
    difficulty: 'hard',
    blueprintArea: 'TCP-VI',
    skillLevel: 'Analysis',
    question: 'A U.S. corporation has a 100%-owned CFC in a low-tax jurisdiction. The CFC earns $5,000,000 in sales income with no tangible assets (QBAI = $0). The CFC pays $50,000 in local taxes. What is the GILTI inclusion?',
    options: [
      '$5,000,000 — the full income is GILTI because DTIR is $0 (no QBAI)',
      '$4,950,000 — income minus foreign taxes',
      '$0 — sales income is not tested income',
      '$2,500,000 — 50% after the §250 deduction',
    ],
    correctAnswer: 0,
    explanation: 'GILTI = tested income − DTIR. DTIR = 10% × QBAI. With QBAI = $0, DTIR = $0, so the entire $5,000,000 of tested income is included as GILTI. This demonstrates why GILTI disproportionately affects asset-light businesses with no tangible depreciable assets abroad. The §250 deduction (50%) reduces the taxable amount at the corporate level, but the inclusion itself remains $5,000,000.',
    reference: 'IRC §951A',
  },
  {
    id: 'tcp-comp-024',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-property',
    topic: 'Property Transactions',
    subtopic: 'Related Party Sales',
    difficulty: 'hard',
    blueprintArea: 'TCP-V',
    skillLevel: 'Analysis',
    question: 'Losses on sales between related parties are:',
    options: [
      'Fully deductible',
      'Disallowed to seller but buyer gets carryover basis that may offset gain on subsequent sale',
      'Capitalized',
      'Ordinary deductions',
    ],
    correctAnswer: 1,
    explanation: '§267 related party loss: disallowed. Buyer\'s basis = cost. On buyer\'s subsequent sale to unrelated party, gain reduced (not below zero) by disallowed loss. Constructive ownership rules apply. Does not apply to controlled group sales.',
    reference: 'IRC §267',
  },
  {
    id: 'tcp-comp-025',
    section: 'TCP',
    courseId: 'cpa',
    topicId: 'tcp-procedures',
    topic: 'Tax Procedures',
    subtopic: 'Statute of Limitations',
    difficulty: 'hard',
    blueprintArea: 'TCP-I',
    skillLevel: 'Application',
    question: 'The statute of limitations for IRS assessment is extended to 6 years when:',
    options: [
      'The taxpayer files late',
      'Any adjustment is made',
      'Gross income is understated by more than 25% of the amount reported',
      'A refund is claimed',
    ],
    correctAnswer: 2,
    explanation: 'Normal: 3 years from later of due date or filing. 6-year statute: >25% gross income omission (including items not included - overstatement of basis). Unlimited: fraud, no return filed. Taxpayer can consent to extend.',
    reference: 'IRC §6501',
  },
];
