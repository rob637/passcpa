/**
 * EA SEE Part 2: Businesses - Flashcard Formulas
 * Key calculations for the Businesses section
 */

import { EAFlashcard } from './types';

export const SEE2_FORMULAS: EAFlashcard[] = [
  // ============================================
  // Depreciation Calculations
  // ============================================
  {
    id: 'see2-form-001',
    section: 'SEE2',
    type: 'formula',
    topic: 'Depreciation',
    subtopic: 'Double Declining Balance',
    blueprintArea: 'SEE2-3',
    front: 'How do you calculate Double Declining Balance depreciation?',
    back: '**DDB Rate = (1/Life) × 2**\n\n**Annual Depreciation = Beginning Book Value × DDB Rate**\n\n• Never depreciate below salvage value\n• Switch to S/L when S/L > DDB for remaining life\n\n**MACRS uses 200% DB** for 3, 5, 7, 10-year property with half-year convention built into tables',
    formula: 'DDB = (2/n) × Book Value',
    example: '5-year asset $10,000: Year 1 = $10,000 × 40% = $4,000',
    difficulty: 'medium',
    tags: ['depreciation', 'DDB'],
    irsReference: 'IRC §168',
  },
  {
    id: 'see2-form-002',
    section: 'SEE2',
    type: 'formula',
    topic: 'Depreciation',
    subtopic: 'MACRS Tables',
    blueprintArea: 'SEE2-3',
    front: 'What are the key MACRS depreciation percentages?',
    back: '**5-Year Property (Half-Year):**\nYr 1: 20% | Yr 2: 32% | Yr 3: 19.2% | Yr 4: 11.52% | Yr 5: 11.52% | Yr 6: 5.76%\n\n**7-Year Property (Half-Year):**\nYr 1: 14.29% | Yr 2: 24.49% | Yr 3: 17.49% | Yr 4: 12.49%...\n\n**39-Year (Mid-Month):**\nMonthly rate: 2.564%/month × months in service',
    formula: 'Depreciation = Cost × MACRS %',
    difficulty: 'hard',
    tags: ['depreciation', 'MACRS'],
    irsReference: 'IRC §168; Pub 946',
  },
  {
    id: 'see2-form-003',
    section: 'SEE2',
    type: 'formula',
    topic: 'Depreciation',
    subtopic: 'Luxury Auto Limits',
    blueprintArea: 'SEE2-3',
    front: 'What are the 2024 luxury automobile depreciation limits?',
    back: '**Without Bonus Depreciation:**\n• Year 1: $12,400\n• Year 2: $19,800\n• Year 3: $11,900\n• Year 4+: $7,160\n\n**With 60% Bonus (2024):**\n• Year 1: $20,400\n• Years 2-4+: Same as above\n\n**SUV Exception:** Vehicles >6,000 lbs GVWR not subject to limits',
    formula: 'Lower of: MACRS depreciation OR Luxury limit',
    difficulty: 'hard',
    tags: ['depreciation', 'auto'],
    irsReference: 'IRC §280F; Rev. Proc. 2024-13',
  },
  // ============================================
  // Partnership Calculations
  // ============================================
  {
    id: 'see2-form-004',
    section: 'SEE2',
    type: 'formula',
    topic: 'Partnership',
    subtopic: 'Partner Basis',
    blueprintArea: 'SEE2-5',
    front: 'What is the formula for calculating partner\'s outside basis?',
    back: '**Beginning Basis**\n+ Share of income (ordinary and separately stated)\n+ Share of tax-exempt income\n+ Partner contributions\n+ Increase in share of liabilities\n− Distributions received\n− Share of losses and deductions\n− Share of nondeductible expenses\n− Decrease in share of liabilities\n= **Ending Basis** (cannot go below zero)',
    formula: 'Ending Basis = Beginning + (Income − Losses − Distributions) ± Liability Change',
    difficulty: 'hard',
    tags: ['partnership', 'basis'],
    irsReference: 'IRC §705',
  },
  {
    id: 'see2-form-005',
    section: 'SEE2',
    type: 'formula',
    topic: 'Partnership',
    subtopic: 'Liability Allocation',
    blueprintArea: 'SEE2-5',
    front: 'How are partnership liabilities allocated to partners?',
    back: '**Recourse Liabilities:**\nAllocated to partners who bear economic risk of loss\n\n**Nonrecourse Liabilities (3-tier):**\n1. First: To partners with minimum gain\n2. Second: Based on §704(c) minimum gain\n3. Third: By profit-sharing ratios\n\n**General rule for simple partnerships:**\nRecourse → General partners\nNonrecourse → All partners by profit share',
    formula: 'Liability share increases basis dollar-for-dollar',
    difficulty: 'hard',
    tags: ['partnership', 'liabilities'],
    irsReference: 'IRC §752',
  },
  {
    id: 'see2-form-006',
    section: 'SEE2',
    type: 'formula',
    topic: 'Partnership',
    subtopic: 'Hot Assets',
    blueprintArea: 'SEE2-5',
    front: 'What are "hot assets" and how do they affect partnership sales?',
    back: '**Hot Assets (IRC §751):**\n• Unrealized receivables\n• Inventory (substantially appreciated)\n\n**Effect on Sale of Partnership Interest:**\nGain/loss attributable to hot assets = Ordinary income/loss\n\n**Substantially Appreciated Inventory:**\nFMV > 120% of adjusted basis',
    formula: 'Ordinary gain = Share of hot asset appreciation',
    difficulty: 'hard',
    tags: ['partnership', 'hot assets'],
    irsReference: 'IRC §751',
  },
  // ============================================
  // S Corporation Calculations
  // ============================================
  {
    id: 'see2-form-007',
    section: 'SEE2',
    type: 'formula',
    topic: 'S Corporation',
    subtopic: 'Shareholder Basis',
    blueprintArea: 'SEE2-7',
    front: 'What is the formula for S corporation shareholder basis?',
    back: '**Stock Basis Calculation (Order matters!):**\n\nBeginning Stock Basis\n+ Income items (ordinary and separately stated)\n+ Tax-exempt income\n+ Excess depletion\n− Distributions (limited to basis)\n− Non-deductible expenses\n− Deductible losses (limited to remaining basis)\n= Ending Stock Basis\n\n**Debt Basis:** Only from direct shareholder loans to corp',
    formula: 'Stock Basis + Debt Basis = Total Loss Deduction Limit',
    difficulty: 'hard',
    tags: ['S corp', 'basis'],
    irsReference: 'IRC §1367',
  },
  {
    id: 'see2-form-008',
    section: 'SEE2',
    type: 'formula',
    topic: 'S Corporation',
    subtopic: 'AAA',
    blueprintArea: 'SEE2-7',
    front: 'What is the Accumulated Adjustments Account (AAA)?',
    back: '**AAA tracks S corp earnings that can be distributed tax-free**\n\n**Calculation:**\nPrior AAA Balance\n+ Ordinary income/Separately stated income\n− Ordinary loss/Deductions\n− Distributions (limited to AAA)\n= Ending AAA\n\n**Note:** Tax-exempt income increases stock basis but NOT AAA\n**AAA can go negative** (from losses, not distributions)',
    formula: 'AAA = Prior AAA + Income − Losses − Distributions',
    difficulty: 'hard',
    tags: ['S corp', 'AAA'],
    irsReference: 'IRC §1368',
  },
  // ============================================
  // Corporate Calculations
  // ============================================
  {
    id: 'see2-form-009',
    section: 'SEE2',
    type: 'formula',
    topic: 'Corporation',
    subtopic: 'Charitable Deduction Limit',
    blueprintArea: 'SEE2-6',
    front: 'What is the charitable contribution limit for C corporations?',
    back: '**Limit: 10% of Taxable Income**\n\n**Taxable Income computed WITHOUT:**\n• Charitable contribution deduction\n• DRD (Dividends Received Deduction)\n• NOL carryback\n• Capital loss carryback\n\n**Carryover:** Excess carries forward 5 years',
    formula: 'Max Deduction = Modified Taxable Income × 10%',
    example: 'Taxable income (pre-charity/DRD) $1M → Max deduction $100,000',
    difficulty: 'medium',
    tags: ['corporation', 'charitable'],
    irsReference: 'IRC §170(b)(2)',
  },
  {
    id: 'see2-form-010',
    section: 'SEE2',
    type: 'formula',
    topic: 'Corporation',
    subtopic: 'DRD',
    blueprintArea: 'SEE2-6',
    front: 'What are the Dividends Received Deduction (DRD) percentages?',
    back: '**DRD Based on Ownership %:**\n\n• <20% ownership: 50% DRD\n• 20%-79% ownership: 65% DRD\n• 80%+ ownership: 100% DRD (affiliated group)\n\n**Limitation:** Cannot exceed same % of taxable income (unless creates/increases NOL)\n\n**Purpose:** Prevent triple taxation of corporate earnings',
    formula: 'DRD = Dividends Received × DRD%',
    example: '$100,000 dividends, 15% ownership → $50,000 DRD',
    difficulty: 'medium',
    tags: ['corporation', 'DRD'],
    irsReference: 'IRC §243',
  },
  {
    id: 'see2-form-011',
    section: 'SEE2',
    type: 'formula',
    topic: 'Corporation',
    subtopic: 'E&P Calculation',
    blueprintArea: 'SEE2-6',
    front: 'How is corporate Earnings and Profits (E&P) calculated?',
    back: '**Taxable Income**\n+ Tax-exempt income\n+ Life insurance proceeds\n+ Excess percentage depletion\n+ DRD adjustment (add back)\n− Federal income taxes\n− Nondeductible penalties/fines\n− Related party losses denied\n− Excess capital losses\n± Depreciation adjustment (E&P uses S/L, ADS)\n= **Current E&P**',
    formula: 'Current E&P = Taxable Income ± Adjustments',
    difficulty: 'hard',
    tags: ['corporation', 'E&P'],
    irsReference: 'IRC §312',
  },
  // ============================================
  // Business Income Calculations
  // ============================================
  {
    id: 'see2-form-012',
    section: 'SEE2',
    type: 'formula',
    topic: 'Schedule C',
    subtopic: 'Cost of Goods Sold',
    blueprintArea: 'SEE2-4',
    front: 'How is Cost of Goods Sold calculated?',
    back: '**Beginning Inventory**\n+ Purchases\n+ Labor\n+ Materials/Supplies\n+ Other Costs\n= **Cost of Goods Available**\n− Ending Inventory\n= **Cost of Goods Sold**',
    formula: 'COGS = Beginning Inventory + Purchases − Ending Inventory',
    example: 'Beginning $10K + Purchases $50K − Ending $15K = COGS $45K',
    difficulty: 'easy',
    tags: ['inventory', 'COGS'],
    irsReference: 'IRC §263A',
  },
  {
    id: 'see2-form-013',
    section: 'SEE2',
    type: 'formula',
    topic: 'Home Office',
    subtopic: 'Simplified Method',
    blueprintArea: 'SEE2-4',
    front: 'What is the simplified method for home office deduction?',
    back: '**Simplified Method:**\n$5 per square foot (max 300 sq ft)\n= **Maximum $1,500 deduction**\n\n**Regular Method:**\n(Business sq ft ÷ Total sq ft) × Actual Expenses\n\n**Actual expenses include:**\nMortgage interest, taxes, insurance, utilities, repairs, depreciation',
    formula: 'Simplified: Square feet × $5 (max $1,500)',
    difficulty: 'easy',
    tags: ['home office'],
    irsReference: 'Rev. Proc. 2013-13',
  },
  {
    id: 'see2-form-014',
    section: 'SEE2',
    type: 'formula',
    topic: 'Business Use',
    subtopic: 'Vehicle Expenses',
    blueprintArea: 'SEE2-4',
    front: 'What are the two methods for deducting vehicle expenses?',
    back: '**Standard Mileage Rate (2024):**\n• Business: 67¢ per mile\n• Medical/Moving: 21¢ per mile\n• Charity: 14¢ per mile\n\n**Actual Expense Method:**\n(Business miles ÷ Total miles) × Actual costs\n\n**Actual costs:** Gas, insurance, repairs, depreciation, registration\n\n**Must use actual method if:** Fleet of 5+ or claimed depreciation in prior years',
    formula: 'Standard: Business miles × $0.67',
    difficulty: 'easy',
    tags: ['vehicle', 'expenses'],
    irsReference: 'IRC §274; Notice 2024-8',
  },
  {
    id: 'see2-form-015',
    section: 'SEE2',
    type: 'formula',
    topic: 'Retirement',
    subtopic: 'SEP-IRA Contribution',
    blueprintArea: 'SEE2-2',
    front: 'What is the maximum SEP-IRA contribution for self-employed?',
    back: '**Employees:** 25% of compensation (up to $69,000 in 2024)\n\n**Self-Employed (more complex):**\n\n**Step 1:** Net SE income × 92.35%\n**Step 2:** Result × 20% (not 25%!)\n\n**Why 20%?** The deduction itself reduces SE income, so effective rate is 20%\n\n**Max contribution:** $69,000 (2024)',
    formula: 'SE Contribution = (Net SE × 0.9235) × 0.20',
    example: '$200,000 net SE → $200,000 × 0.9235 × 0.20 = $36,940',
    difficulty: 'hard',
    tags: ['retirement', 'SEP'],
    irsReference: 'IRC §404(h); §408(k)',
  },
];
