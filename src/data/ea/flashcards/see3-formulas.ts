/**
 * EA SEE Part 3: Representation - Flashcard Formulas
 * Key calculations for penalties, interest, and procedural thresholds
 */

import { EAFlashcard } from './types';

export const SEE3_FORMULAS: EAFlashcard[] = [
  // ============================================
  // Penalty Calculations
  // ============================================
  {
    id: 'see3-form-001',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Failure to File',
    blueprintArea: 'SEE3-6',
    front: 'How is the failure to file penalty calculated?',
    back: '**Failure to File (FTF) Penalty:**\n\n**Rate:** 5% of unpaid tax per month (or part of month)\n**Maximum:** 25% of unpaid tax\n**Minimum:** Lesser of $485 or 100% of tax (if >60 days late)\n\n**Reduction:** FTF reduced by FTP if both apply\n\n**When assessed together:**\nFTF 5% - FTP 0.5% = Net 4.5% per month',
    formula: 'FTF = Unpaid Tax × 5% × Months Late (max 25%)',
    example: '$10,000 unpaid, 3 months late: $10,000 × 5% × 3 = $1,500',
    difficulty: 'medium',
    tags: ['penalties', 'FTF'],
    irsReference: 'IRC §6651(a)(1)',
  },
  {
    id: 'see3-form-002',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Failure to Pay',
    blueprintArea: 'SEE3-6',
    front: 'How is the failure to pay penalty calculated?',
    back: '**Failure to Pay (FTP) Penalty:**\n\n**Rate:** 0.5% of unpaid tax per month\n**Maximum:** 25% of unpaid tax\n\n**Increases to 1%:** If IRS issues levy notice and 10 days passes without payment\n\n**Decreases to 0.25%:** If taxpayer has installment agreement in place',
    formula: 'FTP = Unpaid Tax × 0.5% × Months (max 25%)',
    example: '$10,000 unpaid, 6 months: $10,000 × 0.5% × 6 = $300',
    difficulty: 'medium',
    tags: ['penalties', 'FTP'],
    irsReference: 'IRC §6651(a)(2)',
  },
  {
    id: 'see3-form-003',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Combined Penalties',
    blueprintArea: 'SEE3-6',
    front: 'What is the maximum combined FTF and FTP penalty?',
    back: '**Combined Maximum: 47.5%**\n\n**Calculation:**\n• FTF max: 25% (over 5 months)\n• FTP max: 25% (over 50 months)\n• But FTF is reduced by FTP: Net FTF = 22.5%\n• Combined: 22.5% + 25% = **47.5%**\n\n**Timeline for maximum:**\n• First 5 months: FTF dominates (4.5% net + 0.5% FTP = 5%)\n• After 5 months: FTP only (0.5%/month until maxed)',
    formula: 'Max Total = 47.5% (22.5% FTF + 25% FTP)',
    difficulty: 'hard',
    tags: ['penalties', 'combined'],
    irsReference: 'IRC §6651',
  },
  {
    id: 'see3-form-004',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Accuracy-Related',
    blueprintArea: 'SEE3-6',
    front: 'What constitutes a "substantial understatement"?',
    back: '**Substantial Understatement (Individuals):**\n\nGreater of:\n• $5,000, OR\n• 10% of correct tax\n\n**Substantial Understatement (Corporations):**\n\nGreater of:\n• $10,000, OR\n• 10% of correct tax (or 5% if tax >$10 million)\n\n**Penalty:** 20% of underpayment',
    formula: 'Substantial = Greater of $5,000 or 10% of correct tax',
    example: 'Correct tax $80,000, reported $60,000 → Understatement $20,000 (>$8,000 threshold)',
    difficulty: 'medium',
    tags: ['penalties', 'substantial'],
    irsReference: 'IRC §6662(d)',
  },
  {
    id: 'see3-form-005',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Estimated Tax',
    blueprintArea: 'SEE3-6',
    front: 'How is the underpayment of estimated tax penalty calculated?',
    back: '**Estimated Tax Penalty (IRC §6654):**\n\n**Applies if:** Required annual payment not met through withholding + estimates\n\n**Required payment (lesser of):**\n• 90% of current year tax, OR\n• 100% of prior year tax (110% if AGI >$150,000)\n\n**Penalty rate:** Federal short-term rate + 3%\n\n**Calculated quarterly:** Jan 15, Apr 15, Jun 15, Sep 15',
    formula: 'Penalty = Underpayment × (Federal S/T Rate + 3%) × Days/365',
    difficulty: 'hard',
    tags: ['penalties', 'estimated tax'],
    irsReference: 'IRC §6654',
  },
  // ============================================
  // Interest Calculations
  // ============================================
  {
    id: 'see3-form-006',
    section: 'SEE3',
    type: 'formula',
    topic: 'Interest',
    subtopic: 'Underpayment Rate',
    blueprintArea: 'SEE3-6',
    front: 'How is IRS interest on underpayments calculated?',
    back: '**Underpayment Interest Rate:**\n\nFederal short-term rate + 3%\n\n**Compounded daily** from due date until paid\n\n**Corporate rates:**\n• Standard: Short-term + 3%\n• Large corporate underpayments: Short-term + 5%\n\n**Overpayment (refund) rate:**\n• Short-term + 3% (individuals)\n• Short-term + 2% (corporations)',
    formula: 'Interest = Principal × (FedRate + 3%) × Days/365',
    difficulty: 'medium',
    tags: ['interest', 'underpayment'],
    irsReference: 'IRC §6621',
  },
  {
    id: 'see3-form-007',
    section: 'SEE3',
    type: 'formula',
    topic: 'Interest',
    subtopic: 'Interest Runs',
    blueprintArea: 'SEE3-6',
    front: 'When does IRS interest start and stop running?',
    back: '**Interest on underpayment:**\n• **Starts:** Original due date (without extensions)\n• **Stops:** Date of payment\n\n**Interest on overpayment (refund):**\n• **Starts:** Later of due date or payment date\n• **Stops:** Date refund issued\n• **No interest if:** Refund within 45 days of filing\n\n**Suspension:** No interest during certain delays by IRS (§6404(g))',
    formula: 'Interest period = Due date → Payment date',
    difficulty: 'medium',
    tags: ['interest', 'timing'],
    irsReference: 'IRC §6601; §6611',
  },
  // ============================================
  // Statute of Limitations Periods
  // ============================================
  {
    id: 'see3-form-008',
    section: 'SEE3',
    type: 'formula',
    topic: 'Statute of Limitations',
    subtopic: 'Assessment Periods',
    blueprintArea: 'SEE3-4',
    front: 'What are all the assessment statute of limitations periods?',
    back: '**Assessment Periods:**\n\n• **3 years:** Standard (from later of due date or filing)\n• **6 years:** >25% gross income omission; FBAR violations\n• **Unlimited:** No return filed, fraud, false return\n\n**Collection Statute:**\n• **10 years** from date of assessment (CSED)\n\n**Refund Claim:**\n• Later of 3 years from filing or 2 years from payment',
    formula: '3-6-10-Unlimited pattern',
    difficulty: 'hard',
    tags: ['statute', 'assessment'],
    irsReference: 'IRC §6501; §6502; §6511',
  },
  // ============================================
  // OIC Calculations
  // ============================================
  {
    id: 'see3-form-009',
    section: 'SEE3',
    type: 'formula',
    topic: 'Collection',
    subtopic: 'OIC Formula',
    blueprintArea: 'SEE3-5',
    front: 'How does the IRS calculate reasonable collection potential (RCP) for OICs?',
    back: '**Reasonable Collection Potential (RCP):**\n\n**RCP = Net Equity in Assets + Future Income**\n\n**Net Equity:**\nFMV of assets × 80% (quick sale value) − Encumbrances\n\n**Future Income:**\n• Lump Sum: Monthly disposable income × 12\n• Periodic: Monthly disposable income × 24\n\n**OIC must equal or exceed RCP to be accepted**',
    formula: 'RCP = Quick Sale Value + (Monthly Income × 12 or 24)',
    example: 'Assets QSV $20K, Monthly disposable $500, Lump Sum:\nRCP = $20,000 + ($500 × 12) = $26,000',
    difficulty: 'hard',
    tags: ['OIC', 'collection'],
    irsReference: 'IRM 5.8.5',
  },
  {
    id: 'see3-form-010',
    section: 'SEE3',
    type: 'formula',
    topic: 'Collection',
    subtopic: 'Allowable Expenses',
    blueprintArea: 'SEE3-5',
    front: 'What expenses does IRS allow when calculating disposable income?',
    back: '**IRS Collection Financial Standards:**\n\n**National Standards (fixed):**\n• Food, clothing, personal care\n• Out-of-pocket health care\n\n**Local Standards (varies by location):**\n• Housing and utilities\n• Transportation (ownership + operating)\n\n**Other Necessary Expenses (actual):**\n• Court-ordered payments\n• Dependent care\n• Life insurance (term only)\n\n**Disposable = Income − Allowable Expenses**',
    formula: 'Disposable Income = Gross − National − Local − Other Necessary',
    difficulty: 'hard',
    tags: ['collection', 'expenses'],
    irsReference: 'IRM 5.15.1',
  },
  // ============================================
  // Preparer Penalties
  // ============================================
  {
    id: 'see3-form-011',
    section: 'SEE3',
    type: 'formula',
    topic: 'Preparer Penalties',
    subtopic: 'Preparer Penalty Amounts',
    blueprintArea: 'SEE3-2',
    front: 'What are the tax return preparer penalties?',
    back: '**Return Preparer Penalties:**\n\n**§6694(a) - Unreasonable Position:**\n• Greater of $1,000 or 50% of income derived\n• No reasonable basis (disclosed) or\n• No substantial authority (undisclosed)\n\n**§6694(b) - Willful/Reckless:**\n• Greater of $5,000 or 75% of income derived\n\n**§6695 - Other violations:**\n• Failure to sign: $60\n• Failure to furnish copy to taxpayer: $60\n• Failure to keep copy/list: $60\n• Failure to include PTIN: $60',
    formula: 'Unreasonable: Greater of $1,000 or 50% of fees\nWillful: Greater of $5,000 or 75% of fees',
    difficulty: 'medium',
    tags: ['preparer', 'penalties'],
    irsReference: 'IRC §6694; §6695',
  },
  {
    id: 'see3-form-012',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Information Return Penalties',
    blueprintArea: 'SEE3-6',
    front: 'What are the penalties for failure to file information returns?',
    back: '**Information Return Penalties (§6721):**\n\n**Based on when corrected:**\n• Within 30 days: $60/return\n• Between 31 days and Aug 1: $130/return\n• After Aug 1 or not corrected: $330/return\n\n**Intentional disregard:** $660/return (no maximum)\n\n**Small business max ($6M or less):**\n• 30-day: $230,500\n• 31-Aug 1: $693,500\n• After Aug 1: $1,387,000',
    formula: 'Penalty increases based on: 30-day, Aug 1, Never corrected',
    difficulty: 'hard',
    tags: ['penalties', 'information returns'],
    irsReference: 'IRC §6721; §6722',
  },
  // ============================================
  // Appeals Thresholds
  // ============================================
  {
    id: 'see3-form-013',
    section: 'SEE3',
    type: 'formula',
    topic: 'Appeals',
    subtopic: 'Request Thresholds',
    blueprintArea: 'SEE3-7',
    front: 'What are the dollar thresholds for different appeal procedures?',
    back: '**Appeals Process Thresholds:**\n\n**Small Case Request (Form 12203):**\n• Total amount ≤$25,000 for any one tax period\n\n**Written Protest Required:**\n• Total amount >$25,000\n• Must include statement of facts, law, arguments\n\n**Tax Court Small Case:**\n• Amount in dispute ≤$50,000\n• Decision is final (no appeal)',
    formula: '<$25K: Form 12203 | >$25K: Written Protest | <$50K: Small Tax Court',
    difficulty: 'medium',
    tags: ['appeals', 'thresholds'],
    irsReference: 'IRM 8.1.1; IRC §7463',
  },
  {
    id: 'see3-form-014',
    section: 'SEE3',
    type: 'formula',
    topic: 'Penalties',
    subtopic: 'Trust Fund Recovery',
    blueprintArea: 'SEE3-6',
    front: 'What is the Trust Fund Recovery Penalty (TFRP)?',
    back: '**Trust Fund Recovery Penalty (TFRP):**\n\n**Amount:** 100% of trust fund taxes not remitted\n\n**Trust fund taxes:**\n• Income tax withheld from employees\n• Employee share of FICA\n\n**NOT trust fund:** Employer share of FICA, FUTA\n\n**Who is liable:**\n• "Responsible person" who\n• "Willfully" failed to collect/pay\n\n**Personal liability** - assessed against individuals',
    formula: 'TFRP = 100% of withheld + employee FICA',
    example: '$50,000 withheld + $25,000 employee FICA = $75,000 TFRP',
    difficulty: 'hard',
    tags: ['TFRP', 'trust fund'],
    irsReference: 'IRC §6672',
  },
  {
    id: 'see3-form-015',
    section: 'SEE3',
    type: 'formula',
    topic: 'Collection',
    subtopic: 'Installment Agreement',
    blueprintArea: 'SEE3-5',
    front: 'What are the installment agreement thresholds and fees?',
    back: '**Installment Agreement Thresholds:**\n\n**Guaranteed (must approve):**\n• Balance ≤$10,000\n• All returns filed for 5 years\n• Full payment in 36 months\n\n**Streamlined:**\n• Individual: ≤$50,000 (72 months)\n• Business: ≤$25,000 (24 months)\n\n**Setup Fees (2024):**\n• Online/Direct Debit: $31\n• Phone/Mail/Direct Debit: $107\n• Standard: $178\n• Low-income: $43 (may be reimbursed)',
    formula: 'Guaranteed: ≤$10K/36mo | Streamlined: ≤$50K/72mo',
    difficulty: 'medium',
    tags: ['installment', 'collection'],
    irsReference: 'IRC §6159',
  },
];
